<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISGES - Dashboard</title>
    <link rel="shortcut icon" href="img/LogoRojo.png" type="image/x-icon">
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <!-- Google Fonts: Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/dashboard.css">
</head>
<body>
    <div class="main-wrapper">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="d-flex flex-column align-items-center">
                    <img src="img/SISGESLogo.png" alt="Logo SISGES" class="logo mb-3">
                </div>
            </div>

            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link active" href="#dashboard" data-content="dashboard">
                        <i class="fas fa-chart-line"></i>
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#nueva" data-content="nueva">
                        <i class="fas fa-plus-circle"></i>
                        Nueva Solicitud Ciudadana
                    </a>
                </li>
                <li class="nav-item" id="navAcuerdo">
                    <a class="nav-link" href="#acuerdo" data-content="acuerdo">
                        <i class="fas fa-handshake"></i>
                        Nuevo Acuerdo de Gabinete
                    </a>
                </li>
                <li class="nav-item" id="navOficio">
                    <a class="nav-link" href="#oficio" data-content="oficio">
                        <i class="fas fa-file-contract"></i>
                        Nuevo Oficio
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#seguimiento" data-content="seguimiento">
                        <i class="fas fa-search"></i>
                        Seguimiento
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#verificacion" data-content="verificacion">
                        <i class="fas fa-clipboard-check"></i>
                        Verificación
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#validadas" data-content="validadas">
                        <i class="fa-solid fa-check-double"></i>
                        Validada
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Contenido Principal -->
        <div class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="d-flex align-items-center gap-3">
                    <button class="menu-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="h4 mb-0">¡Bienvenido(a) al SISGES <span id="nombreUsuario"></span>!</h1>
                </div>
                <div class="user-info">
                    <button class="btn btn-custom-primary" id="logoutButton">
                        <i class="fas fa-sign-out-alt"></i>
                        <span class="d-none d-md-inline">Cerrar Sesión</span>
                    </button>
                </div>
            </header>

            <!-- Sección Dashboard -->
            <div id="dashboard-content" class="content-section">
                <h2 class="section-title">
                    <i class="fas fa-chart-pie"></i>
                    Resumen General
                </h2>
                
                <!-- Modificar el stats-grid -->
<div class="stats-grid">
    <div class="stats-card">
        <h5>Pendientes</h5>
        <div class="stats-value" id="stats-pendientes">0</div>
        <small><i class="fas fa-clock"></i> Actualizado ahora</small>
    </div>
    <div class="stats-card">
        <h5>Por Vencer</h5>
        <div class="stats-value" id="stats-vencer">0</div>
        <small><i class="fas fa-exclamation-triangle"></i> Urgentes</small>
    </div>
    <div class="stats-card">
        <h5>En Proceso</h5>
        <div class="stats-value" id="stats-en-proceso">0</div>
        <small><i class="fas fa-spinner"></i> En proceso</small>
    </div>
    <div class="stats-card">
        <h5>Atendidas</h5>
        <div class="stats-value" id="stats-atendidas">0</div>
        <small><i class="fas fa-check-circle"></i> Este mes</small>
    </div>
    <div class="stats-card">
        <h5>Atrasadas</h5>
        <div class="stats-value" id="stats-atrasadas">0</div>
        <small><i class="fas fa-exclamation-circle"></i> Requieren atención</small>
    </div>
    <div class="stats-card">
        <h5>En Verificación</h5>
        <div class="stats-value" id="stats-verificacion">0</div>
        <small><i class="fas fa-clipboard-check"></i> Por revisar</small>
    </div>
    <div class="stats-card">
        <h5>Eficiencia</h5>
        <div class="stats-value" id="stats-eficiencia">0%</div>
        <small><i class="fas fa-chart-line"></i> Meta: 90%</small>
    </div>
</div>

<div class="text-end mb-4">
    <button class="btn btn-custom-primary" onclick="exportAllCharts()">
        <i class="fas fa-file-archive me-2"></i>
        Descargar Todas las Gráficas (ZIP)
    </button>
</div>

<div class="charts-container row g-4">
    <!-- Gráfica Principal Existente -->
    <div class="col-12 col-lg-8">
        <div class="chart-card">
            <div class="chart-header">
                <h5>Distribución de Solicitudes por Tipo</h5>
                <button class="btn btn-export" onclick="exportChart('mainChart', 'distribucion-solicitudes')">
                    <i class="fas fa-download"></i>
                </button>
            </div>
            <div class="chart-container">
                <canvas id="mainChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Nueva Gráfica Circular -->
    <div class="col-12 col-lg-4">
        <div class="chart-card">
            <div class="chart-header">
                <h5>Distribución por Tipo de Documento</h5>
                <button class="btn btn-export" onclick="exportChart('typeChart', 'tipos-documentos')">
                    <i class="fas fa-download"></i>
                </button>
            </div>
            <div class="chart-container">
                <canvas id="typeChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Gráfica de Tendencias -->
    <div class="col-12 col-lg-6">
        <div class="chart-card">
            <div class="chart-header">
                <h5>Tendencias Mensuales</h5>
                <button class="btn btn-export" onclick="exportChart('trendChart', 'tendencias-mensuales')">
                    <i class="fas fa-download"></i>
                </button>
            </div>
            <div class="chart-container">
                <canvas id="trendChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Gráfica de Estado -->
    <div class="col-12 col-lg-6">
        <div class="chart-card">
            <div class="chart-header">
                <h5>Distribución de Estatus</h5>
                <button class="btn btn-export" onclick="exportChart('statusChart', 'estatus-solicitudes')">
                    <i class="fas fa-download"></i>
                </button>
            </div>
            <div class="chart-container">
                <canvas id="statusChart"></canvas>
            </div>
        </div>
    </div>

    <div class="col-12 col-lg-6">
        <div class="chart-card">
            <div class="chart-header">
                <h5>Eficiencia por Departamento</h5>
                <button class="btn btn-export" onclick="exportChart('departmentChart', 'eficiencia-departamentos')">
                    <i class="fas fa-download"></i>
                </button>
            </div>
            <div class="chart-container">
                <canvas id="departmentChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Gráfica de Tiempos de Respuesta -->
    <div class="col-12 col-lg-6">
        <div class="chart-card">
            <div class="chart-header">
                <h5>Tiempos de Respuesta Promedio</h5>
                <button class="btn btn-export" onclick="exportChart('efficiencyChart', 'tiempos-respuesta')">
                    <i class="fas fa-download"></i>
                </button>
            </div>
            <div class="chart-container">
                <canvas id="efficiencyChart"></canvas>
            </div>
        </div>
    </div>
</div>
            </div>

            <!-- Otras secciones -->
            <!-- Sección Nueva Solicitud -->
             <!-- Sección Verificación -->
<div id="verificacion-content" class="content-section" style="display: none;">
    <h2 class="section-title">
        <i class="fas fa-clipboard-check"></i>
        Verificación de Solicitudes
    </h2>
    <div class="filtros-container mb-4">
        <div class="input-group">
            <span class="input-group-text">
                <i class="fas fa-search"></i>
            </span>
            <input type="text" id="busqueda-verificacion" placeholder="Buscar por folio o asunto..." 
                   class="form-control">
        </div>
    </div>
    <div class="custom-table">
        <table class="table">
            <thead>
                <tr>
                    <th>Folio</th>
                    <th>Asunto</th>
                    <th>Tipo</th>
                    <th>Secretaría</th>
                    <th>Fecha Envío</th>
                    <th>Evidencias</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="lista-verificacion">
                <!-- Contenido dinámico -->
            </tbody>
        </table>
    </div>
    <div class="paginacion-container paginacion-verificacion"></div>
</div>

            <div id="nueva-content" class="content-section" style="display: none;">
                <h2 class="section-title">
                    <i class="fas fa-plus-circle"></i>
                    Agregar Solicitud
                </h2>
            
                <div class="form-container">
                    <form id="formNuevaSolicitud" class="needs-validation" novalidate>
                        <div class="row g-3 mb-4">
                            <div class="col-md-4">
                                <label for="fecha" class="form-label">Fecha</label>
                                <input type="date" class="form-control" id="fecha" readonly required>
                            </div>
            
                            <div class="col-md-4">
                                <label for="receptor" class="form-label">Tipo de Solicitud</label>
                                <select class="form-select" id="receptor" required>
                                    <option value="">Seleccionar...</option>
                                    <option>Solicitud Ciudadana</option>
                                    <!-- <option>Oficio</option>
                                    <option>Junta de Gabinete</option> -->
                                </select>
                            </div>
            
                            <div class="col-md-4">
                                <label for="canal" class="form-label">Canal</label>
                                <select class="form-select" id="canal" required>
                                    <option value="">Seleccionar...</option>
                                    <option>Oficina de Presidencia</option>
                                    <option>Audiencias ciudadanas</option>
                                    <option>Audiencias comunitarias</option>
                                    <option>Audiencias virtuales</option>
                                    <option>Recorridos</option>
                                    <option>Redes sociales</option>
                                    <!-- <option>Oficios</option>
                                    <option>Junta de Gabinete</option> -->
                                </select>
                            </div>
                        </div>
            
                        <!-- Segunda Fila -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-4">
                                <label for="nombre" class="form-label">Nombre del peticionario</label>
                                <input type="text" class="form-control" id="nombre" required>
                            </div>
            
                            <div class="col-md-4">
                                <label for="colonia" class="form-label">Colonia</label>
                                <input type="text" class="form-control" id="colonia" required>
                            </div>
            
                            <div class="col-md-4">
                                <label for="telefono" class="form-label">Número telefónico</label>
                                <input type="tel" class="form-control" id="telefono" pattern="[0-9]{10}" required>
                            </div>
                        </div>
            
                        <!-- Tercera Fila -->
                        <div class="row g-3 mb-4">
                            <div class="col-12">
                                <label for="asunto" class="form-label">Asunto</label>
                                <input type="text" class="form-control" id="asunto" required>
                            </div>
            
                            <div class="col-12">
                                <label for="comentarios" class="form-label">Comentarios</label>
                                <textarea class="form-control" id="comentarios" rows="3"></textarea>
                            </div>
                        </div>
            
                        <!-- Cuarta Fila -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-4">
                                <label for="secretaria" class="form-label">Secretaría Asignada</label>
                                <select class="form-select" id="secretaria" required>
                                </select>
                            </div>
                        </div>

                        <!-- Nueva Sección para Documento Inicial -->
                        <div class="row g-3 mb-4">
                            <div class="col-12">
                                <label for="documentoInicial" class="form-label">Documento Inicial</label>
                                <div class="file-drop-area rounded-3 border-2 border-dashed p-4 text-center">
                                    <div class="mb-3 text-muted">
                                        <i class="fas fa-cloud-upload-alt fa-3x"></i>
                                    </div>
                                    <input type="file" 
                                           class="form-control visually-hidden" 
                                           id="documentoInicial" 
                                           accept=".pdf,.jpg,.jpeg,.png,.zip,.rar" 
                                           required>
                                    <label for="documentoInicial" class="btn btn-outline-primary mb-2">
                                        <i class="fas fa-file-upload me-2"></i>Seleccionar archivo
                                    </label>
                                    <div class="file-info small text-muted" id="docInicialInfo">
                                        Formatos permitidos: PDF, JPG, PNG, ZIP, RAR (Máx. 10MB)
                                    </div>
                                    <button class="btn btn-sm btn-danger mt-2 d-none" id="removeDocInicial">
                                        <i class="fas fa-times me-1"></i>Remover archivo
                                    </button>
                                </div>
                            </div>
                        </div>
            
                        <!-- Botones -->
                        <div class="d-flex justify-content-end gap-3 mt-5">
                            <button type="reset" class="btn btn-custom-secondary">
                                <i class="fas fa-eraser me-2"></i>Limpiar
                            </button>
                            <button type="submit" class="btn btn-custom-primary">
                                <i class="fas fa-save me-2"></i>Guardar Solicitud
                            </button>
                        </div>
                    </form>
                </div>
            </div>

<!-- Sección Nuevo Acuerdo de Gabinete -->
<!-- Sección Nuevo Acuerdo de Gabinete -->
<div id="acuerdo-content" class="content-section" style="display: none;">
    <h2 class="section-title">
        <i class="fas fa-handshake"></i>
        Agregar Acuerdo de Gabinete
    </h2>
    <div class="form-container">
        <form id="formNuevoAcuerdo" class="needs-validation" novalidate>
            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <label for="fechaAcuerdo" class="form-label">Fecha</label>
                    <input type="date" class="form-control" id="fechaAcuerdo" readonly required>
                </div>
                
                <div class="col-md-8">
                    <label for="asuntoAcuerdo" class="form-label">Asunto</label>
                    <input type="text" class="form-control" id="asuntoAcuerdo" required>
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-12">
                    <label for="descripcionAcuerdo" class="form-label">Descripción del acuerdo</label>
                    <textarea class="form-control" id="descripcionAcuerdo" rows="3" required></textarea>
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <label for="fechaLimiteAcuerdo" class="form-label">Fecha Límite</label>
                    <input type="date" class="form-control" id="fechaLimiteAcuerdo" required>
                </div>
                
                <div class="col-md-6">
                    <label for="secretariaAcuerdo" class="form-label">Secretaría Asignada</label>
                    <select class="form-select" id="secretariaAcuerdo" required></select>
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-12">
                    <label for="comentariosAcuerdo" class="form-label">Comentarios</label>
                    <textarea class="form-control" id="comentariosAcuerdo" rows="2"></textarea>
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-12">
                    <label for="documentoAcuerdo" class="form-label">Documento Inicial</label>
                    <div class="file-drop-area rounded-3 border-2 border-dashed p-4 text-center">
                        <div class="mb-3 text-muted">
                            <i class="fas fa-cloud-upload-alt fa-3x"></i>
                        </div>
                        <input type="file" 
                               class="form-control visually-hidden" 
                               id="documentoAcuerdo" 
                               accept=".pdf,.jpg,.jpeg,.png,.zip,.rar" 
                               required>
                        <label for="documentoAcuerdo" class="btn btn-outline-primary mb-2">
                            <i class="fas fa-file-upload me-2"></i>Seleccionar archivo
                        </label>
                        <div class="file-info small text-muted" id="docAcuerdoInfo">
                            Formatos permitidos: PDF, JPG, PNG, ZIP, RAR (Máx. 10MB)
                        </div>
                        <button class="btn btn-sm btn-danger mt-2 d-none" id="removeDocAcuerdo">
                            <i class="fas fa-times me-1"></i>Remover archivo
                        </button>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-end gap-3 mt-5">
                <button type="reset" class="btn btn-custom-secondary">
                    <i class="fas fa-eraser me-2"></i>Limpiar
                </button>
                <button type="submit" class="btn btn-custom-primary">
                    <i class="fas fa-save me-2"></i>Guardar Acuerdo
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Sección Nuevo Oficio -->
<div id="oficio-content" class="content-section" style="display: none;">
    <h2 class="section-title">
        <i class="fas fa-file-contract"></i>
        Agregar Oficio
    </h2>
    <div class="form-container">
        <form id="formNuevoOficio" class="needs-validation" novalidate>
            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <label for="fechaOficio" class="form-label">Fecha</label>
                    <input type="date" class="form-control" id="fechaOficio" readonly required>
                </div>
                
                <div class="col-md-8">
                    <label for="asuntoOficio" class="form-label">Asunto</label>
                    <input type="text" class="form-control" id="asuntoOficio" required>
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-12">
                    <label for="descripcionOficio" class="form-label">Descripción del Oficio</label>
                    <textarea class="form-control" id="descripcionOficio" rows="3" required></textarea>
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <label for="fechaLimiteOficio" class="form-label">Fecha Límite</label>
                    <input type="date" class="form-control" id="fechaLimiteOficio" required>
                </div>
                
                <div class="col-md-6">
                    <label for="secretariaOficio" class="form-label">Secretaría Asignada</label>
                    <select class="form-select" id="secretariaOficio" required></select>
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-12">
                    <label for="comentariosOficio" class="form-label">Comentarios</label>
                    <textarea class="form-control" id="comentariosOficio" rows="2"></textarea>
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-12">
                    <label for="documentoOficio" class="form-label">Documento Inicial</label>
                    <div class="file-drop-area rounded-3 border-2 border-dashed p-4 text-center">
                        <div class="mb-3 text-muted">
                            <i class="fas fa-cloud-upload-alt fa-3x"></i>
                        </div>
                        <input type="file" 
                               class="form-control visually-hidden" 
                               id="documentoOficio" 
                               accept=".pdf,.jpg,.jpeg,.png,.zip,.rar" 
                               required>
                        <label for="documentoOficio" class="btn btn-outline-primary mb-2">
                            <i class="fas fa-file-upload me-2"></i>Seleccionar archivo
                        </label>
                        <div class="file-info small text-muted" id="docOficioInfo">
                            Formatos permitidos: PDF, JPG, PNG, ZIP, RAR (Máx. 10MB)
                        </div>
                        <button class="btn btn-sm btn-danger mt-2 d-none" id="removeDocOficio">
                            <i class="fas fa-times me-1"></i>Remover archivo
                        </button>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-end gap-3 mt-5">
                <button type="reset" class="btn btn-custom-secondary">
                    <i class="fas fa-eraser me-2"></i>Limpiar
                </button>
                <button type="submit" class="btn btn-custom-primary">
                    <i class="fas fa-save me-2"></i>Guardar Oficio
                </button>
            </div>
        </form>
    </div>
</div>

           <!-- Sección Seguimiento -->
        <div id="seguimiento-content" class="content-section" style="display: none;">
            <h2 class="section-title">
                <i class="fas fa-search"></i>
                Seguimiento de Solicitudes
            </h2>
            <div class="filtros-container mb-4">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" id="busqueda-seguimiento" placeholder="Buscar por folio, asunto o secretaría..." 
                           class="form-control">
                </div>
                <select id="filtro-estado-seguimiento" class="form-select">
                    <option value="">Todos los estados</option>
                    <option value="pendiente">Pendiente</option>
                    <option value="por_vencer">Por Vencer</option>
                    <option value="en_proceso">En Proceso</option>
                    <option value="atrasada">Atrasada</option>
                    <option value="atendida">Atendida</option>
                </select>
            </div>
            <div class="custom-table">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Folio</th>
                            <th>Tipo de Solicitud</th> <!-- Nueva columna -->
                            <th>Asunto</th>
                            <th>Secretaría</th>
                            <th>Estado</th>
                            <th>Días Rest.</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="lista-seguimiento">
                        <!-- Contenido dinámico -->
                    </tbody>
                </table>
            </div>
            <div class="paginacion-container paginacion-seguimiento"></div>
        </div>

        <!-- Sección Validadas -->
        <div id="validadas-content" class="content-section" style="display: none;">
            <h2 class="section-title">
                <i class="fa-solid fa-check-double"></i>
                Solicitudes Validadas
            </h2>
            <div class="filtros-container mb-4">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" id="busqueda-validadas" placeholder="Buscar por folio o asunto..." 
                           class="form-control">
                </div>
                <select id="filtro-secretaria-validadas" class="form-select">
                    <option value="">Todas las secretarías</option>
                </select>
            </div>
            <div class="custom-table">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Folio</th>
                            <th>Tipo</th>
                            <th>Asunto</th>
                            <th>Secretaría</th>
                            <th>Fecha Atención</th>
                            <th>Evidencias</th>
                        </tr>
                    </thead>
                    <tbody id="lista-validadas">
                        <!-- Contenido dinámico -->
                    </tbody>
                </table>
            </div>
            <div class="paginacion-container paginacion-validadas"></div>
        </div>
    </div>

    <!-- Modal de Confirmación -->
<div class="modal fade" id="logoutModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-sign-out-alt me-2"></i>Cerrar Sesión</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                ¿Estás seguro de que deseas salir del sistema?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" id="confirmLogout">Salir</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Confirmación En Proceso -->
<div class="modal fade" id="confirmarProcesoModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirmar cambio a En Proceso</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        ¿Está seguro de marcar esta solicitud como "En Proceso"?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-warning" onclick="confirmarCambioEstado('en_proceso')">
          Confirmar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Confirmar Aprobación -->
<div class="modal fade" id="confirmarAprobarModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title"><i class="fas fa-check-circle me-2"></i>Confirmar Aprobación</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          ¿Está seguro de aprobar esta solicitud y marcarla como atendida?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-success" id="confirmarAprobar">Aprobar</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal Confirmar Rechazo -->
  <div class="modal fade" id="confirmarRechazarModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title"><i class="fas fa-times-circle me-2"></i>Confirmar Rechazo</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          ¿Está seguro de rechazar esta solicitud? Se eliminará la evidencia subida.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-danger" id="confirmarRechazar">Rechazar</button>
        </div>
      </div>
    </div>
  </div>

<!-- Modal Confirmación Atendida -->
<div class="modal fade" id="confirmarAtendidaModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">
                    <i class="fas fa-check-circle me-2"></i>Mandar a Verificación 
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Sección de carga de archivos -->
                <div class="upload-section mb-4">
                    <div class="file-drop-area rounded-3 border-2 border-dashed p-4 text-center">
                        <div class="mb-3 text-muted">
                            <i class="fas fa-cloud-upload-alt fa-3x"></i>
                        </div>
                        <input type="file" 
                               class="form-control visually-hidden" 
                               id="evidenciaFile" 
                               accept=".pdf,.jpg,.jpeg,.png,.zip,.rar" 
                               required>
                        <label for="evidenciaFile" class="btn btn-outline-success mb-2">
                            <i class="fas fa-file-upload me-2"></i>Seleccionar archivo
                        </label>
                        <div class="file-info small text-muted" id="fileInfo">
                            Formatos permitidos: PDF, JPG, PNG, ZIP, RAR (Máx. 10MB)
                        </div>
                        <!-- Agrega este botón -->
                        <button class="btn btn-sm btn-danger mt-2 d-none" id="removeFile">
                            <i class="fas fa-times me-1"></i>Remover archivo
                        </button>
                    </div>
                </div>

                <!-- Mensaje de confirmación -->
                <div class="confirmation-message bg-light rounded p-3">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-exclamation-circle text-warning me-3 fs-4"></i>
                        <div>
                            <p class="mb-0 fw-semibold">¿Confirmar que la solicitud ha sido completamente atendida para verificación?</p>
                            <small class="text-muted">Esta acción ni el documento adjunto se pueden deshacer y se mandara a verificación</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer border-0">
                <button type="button" 
                        class="btn btn-lg btn-outline-secondary" 
                        data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancelar
                </button>
                <button type="button" 
                        class="btn btn-lg btn-success"
                        onclick="subirEvidenciaYCambiarEstado()">
                    <i class="fas fa-check me-2"></i>Mandar a Verificación 
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Visualizar Evidencias -->
<div class="modal fade" id="evidenciaModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content border-0" style="background: var(--surface); box-shadow: 0 8px 32px rgba(0,0,0,0.1);">
            <!-- Encabezado Responsivo -->
            <div class="modal-header p-3 p-md-4" style="background: var(--secondary); border-bottom: 2px solid var(--border);">
                <div class="d-flex flex-column w-100 gap-2 gap-md-3">
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                        <div class="d-flex align-items-center gap-2 gap-md-3">
                            <i class="fas fa-file-alt fa-lg fa-xl" style="color: var(--surface);"></i>
                            <div>
                                <h5 class="mb-0 fw-normal" style="color: var(--surface);">Evidencia Digital</h5>
                                <h2 class="mb-0 fs-6 fs-md-5 fw-bold" id="nombreArchivoCompleto" style="color: var(--surface);">-</h2>
                            </div>
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" style="filter: invert(1);"></button>
                    </div>
                    
                    <!-- Metadatos Adaptables -->
                    <div class="d-flex flex-wrap gap-2 gap-md-4" style="color: var(--surface); font-size: 0.9rem;">
                        <div class="d-flex align-items-center gap-2">
                            <i class="fas fa-hashtag" style="color: var(--surface);"></i>
                            <span>Folio: <strong id="folioEvidencia" style="color: var(--surface);">#</strong></span>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <i class="fas fa-building" style="color: var(--surface);"></i>
                            <span>Secretaría de Origen: <strong id="secretariaEvidencia">-</strong></span>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <i class="fas fa-calendar-alt" style="color: var(--surface);"></i>
                            <span>Fecha: <strong id="fechaEvidencia">-</strong></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cuerpo Adaptable -->
            <div class="modal-body p-0">
                <div class="position-relative d-flex flex-column" style="min-height: 50vh; max-height: 70vh;">
                    <!-- Loader -->
                    <div id="loadingPreview" class="d-flex justify-content-center align-items-center h-100">
                        <div class="spinner-border" role="status" style="color: var(--primary);">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                    </div>
                    
                    <!-- Contenedor PDF Ajustado -->
                    <div id="pdfContainer" class="d-none h-100 d-flex flex-column">
                        <div class="pdf-header bg-light px-4 py-3 border-bottom d-flex align-items-center gap-3">
                            <i class="fas fa-file-pdf text-danger fs-5"></i>
                            <span class="text-dark small fw-medium" id="pdfMeta">Cargando documento...</span>
                        </div>
                        
                        <div class="flex-grow-1 d-flex flex-column px-3 pb-3" style="overflow: hidden;">
                            <div class="h-100 bg-white rounded-3 shadow-sm p-2">
                                <iframe id="pdfViewer" 
                                       class="w-100 h-100 border-0 rounded-2"
                                       style="background: white; min-height: 400px;"></iframe>
                            </div>
                        </div>
                    </div>

                    <!-- Visor de Imágenes Adaptable -->
                    <div id="imagenContainer" class="d-none h-100">
                        <div class="image-wrapper text-center p-2 p-md-4">
                            <div class="image-meta mb-2 mb-md-3 small" style="color: var(--text-secondary);">
                                <i class="fas fa-image me-2" style="color: var(--primary);"></i>
                                <span id="imagenDimensions"></span>
                            </div>
                            <img id="visorImagen" 
                                 class="img-fluid shadow-lg rounded-3" 
                                 style="max-height: 60vh; object-fit: contain; border: 1px solid var(--border);">
                        </div>
                    </div>
                    
                    <!-- Sección no soportada -->
                    <div id="visorNoSoportado" class="d-none text-center w-75 mx-auto py-5">
                        <div class="p-5 rounded-3" style="background: color-mix(in srgb, var(--primary) 8%, transparent); border: 2px dashed var(--primary);">
                            <i class="fas fa-file-archive fa-3x mb-4" style="color: var(--primary);"></i>
                            <h5 class="mb-3" style="color: var(--text-primary);">Archivo no visualizable</h5>
                            <p class="mb-0" style="color: var(--text-secondary);">
                                Formato: <span id="tipoArchivo" class="fw-bold" style="color: var(--text-primary);">-</span>
                            </p>
                            <a id="descargarEvidencia" class="btn mt-4" 
                               style="background-color: var(--primary); 
                                      color: var(--surface);
                                      border: 1px solid var(--primary);">
                                <i class="fas fa-download me-2"></i>Descargar
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pie de Página -->
            <div class="modal-footer px-3 px-md-4 py-2" style="border-top: 1px solid var(--border);">
                <div class="w-100 d-flex justify-content-between align-items-center gap-2">
                    <div class="small" style="color: var(--text-secondary);">
                        <i class="fas fa-info-circle me-2" style="color: var(--accent);"></i>
                        <span id="zoomInfo">Vista Previa</span>
                    </div>
                    <button type="button" 
                           class="btn px-3 px-md-4" 
                           data-bs-dismiss="modal"
                           style="background-color: var(--primary); color: var(--surface);">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <!-- En el head de tu HTML -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script type="module" src="js/dashboard.js"></script>
    
</body>
</html>